name: Deploy to production

on:
  push:
    branches:
      - 'master'
    paths:
      - '.github/workflows/deploy.yml'
      - 'version/**'
  workflow_dispatch:

# we don't need GITHUB_TOKEN in this workflow
permissions: {}

jobs:
  deploy:
    name: Deploy to mirror
    runs-on: self-hosted
    environment: technic-mirror
    steps:
      - name: Pull changes
        run: cd $MIRROR_BASEPATH && sudo -u $MIRROR_USER2 -H git pull
        env:
          MIRROR_BASEPATH: ${{ secrets.MIRROR_BASEPATH }}
          MIRROR_USER2: ${{ secrets.MIRROR_USER2 }}
